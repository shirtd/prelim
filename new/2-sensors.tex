% !TeX root = ../new.tex

Let $D$ be a compact subset of $\X$.
% Let $\dist(x, y) = \|x - y\|$ denote the Euclidean distance between points $x,y\in D$ as a subspace of $\X$.
Let $\dist(x, y) = \|x - y\|$ denote the distance between points $x,y\in D$ as a subspace of $\X$.
For $A\subset D$ and $x\in D$ let
\[\dist_A(x) = \min_{a\in A}\dist(x, a)\]
denote the distance from $x$ to the set $A$.
% In the following, we will use open metric balls
% \[\ball_\e(x) = \{y\in\X\mid \dist(x, y) < \e\}\]
We will use open metric balls restricted to $D$ with the subspace topology
\[\ball_\e(x) = \{y\in D\mid \dist(x, y) < \e\}\]
and offsets
% \[A^\e = \dist_A^{-1}[0, \e) = \{x\in \X\mid \dist_A(x) < \e\}.\]
\[A^\e = \{x\in D\mid \dist_A(x) < \e\}.\]

Let $f : D\to \R$ be a $c$-Lipschitz function on $D$.
Let $B_a = f^{-1}(-\infty, a]$ denote the $a$-sublevel set of $f$.
For a subset $A$ of $D$ let $A_a := A\cap B_a$ denote the $a$-sublevelset of $f$ restricted to $A$.
Let $\overline{U} = \X\setminus U$ denote the complement of any subset $U\subset \X$ in $\X$.

Let $P$ be a finite subset of $D$ and $Q_a := P\cap B_a$ for $a\in\R$.
Let $\of > 0 $ and $\omega\in \R$ be constants such that $\P\subseteq D$.

\begin{lemma}\label{lem:psurj}
  Let $i : \hom_0(\cmp{\QQ^\of}, \cmp{\P})\to \hom_0(\cmp{\Q^\of}, \cmp{P})$.

  If $\B$ surrounds $D$ in $\X$ then $\dim~\hom_0(\cmp{\B}, \cmp{D})\geq \rk~i$.
  % If $j$ is surjective then $p : \im~j\to\im~i$ is surjective.
\end{lemma}
\begin{proof}
  Choose a basis for $\im~i$ such that each basis element is represented by a point in $\P\setminus \QQ^\of$.
  Let $x\in \P\setminus \QQ^\of$ be such that $i[x] \neq 0$.
  So there exits some $p\in P$ such that $\dist(p, x) < \delta$ and $p\notin \QQ$, otherwise $x\in\QQ^\of$.
  Therefore, because $f$ is $c$-Lipschitz,
  \[ f(x)\geq f(p) - c\dist(x, p) > \fenn - c\of =\omega.\]

  So $x\in\cmp{\B}$ and, because $x\in \P\subseteq D$, $x\in D\setminus \B$.
  Because $i$ and $\ell : \hom_0(\cmp{\B}, \cmp{D})\to \hom_0(\cmp{\Q^\of}, \cmp{\P})$ are induced by inclusion $\ell[x] = i[x]\neq 0$ in $\hom_0(\cmp{\Q^\of}, \cmp{\P})$.
  That is, every element of $\im~i$ has a preimage in $\hom_0(\cmp{\B}, \cmp{D})$, so we may conclude that $\dim~\hom_0(\cmp{\B}, \cmp{D})\geq \rk~i$.
  % That is, $[x]$ is non-trivial in $\hom_0(\cmp{\B},\cmp{D})$ for all $[x]\in\im~i$, so $\dim~\hom_0(\cmp{\B},\cmp{D})\geq \rk~i$.
\end{proof}

Note that, while there is a surjective map from $\hom_0(\cmp{\B}, \cmp{D})$ to $\im~i$ this map is not necessarily induced by inclusion, as $\QQ^\of\not\subseteq \B$.
We therefore must introduce a larger space $\BB$ that contains $\QQ^\of$ in order to provide a computable criteria for the injectivity of $\ell : \hom_0(\cmp{\B}, \cmp{D})\to\hom_0(\cmp{\Q^\of}, \cmp{\P})$.

\[ \begin{tikzcd}
  (\P, \Q^\of) \arrow[hookrightarrow]{r}\arrow[hookrightarrow]{d} &
  (\P, \QQ^\of) \arrow[hookrightarrow]{d} \\
  %
  (D, \bb) \arrow[hookrightarrow]{r} &
  (D, \BB),
\end{tikzcd}\begin{tikzcd}
  (\cmp{\BB},\cmp{D})\arrow[hookrightarrow]{d}\arrow[hookrightarrow]{r} & %{j} &
  (\cmp{\bb}, \cmp{D}) \arrow[hookrightarrow]{d}\\
  %
  (\cmp{\QQ^\of}, \cmp{\P}) \arrow[hookrightarrow]{r} & %{i} &
  (\cmp{\Q^\of}, \cmp{\P}).
\end{tikzcd}\]

% The following diagram is formed by applying the homology functor.
\begin{equation}\label{dgm:1}\begin{tikzcd}
  \hom_0(\cmp{\BB},\cmp{D})\arrow{d}{m} \arrow{r}{j} & %{j_*} &
  \hom_0(\cmp{\bb}, \cmp{D}) \arrow{d}{\ell} \\
  %
  \hom_0(\cmp{\QQ^\of}, \cmp{\P}) \arrow{r}{i} & %{i_*} &
  \hom_0(\cmp{\Q^\of}, \cmp{\P}).
\end{tikzcd}\end{equation}
% Let $p : \im~j\to\im~i$.

\begin{theorem}[Geometric TCC]\label{thm:geo_tcc}
  Let $D$ be a compact subset of $\X$ and $f : D\to\R$ be $c$-Lipschitz function.
  Let $\omega\in\R$, $\of > 0$ be constants such that $\B$ surrounds $D$ in $\X$.
  Let $P\subset D$ be a finite collection of points and $Q_\alpha := P\cap B_\alpha$ for $\alpha\in\R$.
  Let $j : \hom_0(\cmp{\BB},\cmp{D})\to \hom_0(\cmp{\B},\cmp{D})$ and $i : \hom_0(\cmp{\QQ^\of}, \cmp{\P})\to \hom_0(\cmp{\Q^\of}, \cmp{\P})$ be induced by inclusion.

  If $j$ is surjective and $\rk~i\geq \rk~j$ then $D\setminus \B\subseteq \P$ and $\Q^\of$ surrounds $\P$ in $D$.
\end{theorem}
\begin{proof}
  % As we have shown, $\hom_0(\cmp{\B}, \cmp{D})\cong \hom_0(D\setminus\B)$ because $\B$ surrounds $D$ in $\X$.
  Because $j$ is surjective by hypothesis $\rk~j = \dim~\hom_0(\cmp{\B},\cmp{D})$ so $\rk~j\geq \rk~i$ by Lemma~\ref{lem:psurj}.
  So $\rk~j = \rk~i$ with our assumption that $\rk~i\geq \rk~j$.
  Because $P$ is a finite point set we know that $\im~i$ is finite-dimensional and, because $\rk~i = \rk~j$, $\im~j=\hom_0(\cmp{\B}, \cmp{D})$ is finite dimensional as well.
  
  So $\im~j$ is isomorphic to $\im~i$ as a subspace of $\hom_0(\cmp{\Q^\of}, \cmp{\P})$ which, because $j$ is surjective, requires the map $\ell$ induced by inclusion to be injective.
  Therefore, $D\setminus\bb\subseteq \P$ by Lemma~\ref{lem:coverage}, and $\Q^\of$ surrounds $\P$ in $D$ by Lemma~\ref{lem:cov_surrounds}.
\end{proof}
