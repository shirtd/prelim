% !TeX root = ../new.tex

\clearpage

In the following let $D\subi{w,a} := B_w\cup f\rest_{\comp{B_w}}^{-1}(-\infty,a]$ and $P\subi{w,a} := P\cap D\subi{w,a}$.

Suppose $\b$ surrounds $D$ in $\X$ and $\Q^\of$ surrounds $\P$ in $D$ such that
\begin{itemize}
  \item $D\setminus \B\subseteq \P$,
  \item $\b\cap \P \subseteq \Q^\of\subseteq \B$, and
  \item $\B\cap \P\subseteq \QQ^\of\subseteq \BB$.
\end{itemize}

Because $\Q^\delta$ surrounds $\P$ in $D$ and $D\setminus \B\subseteq \P$ we have
\[ D\subi{\omega,\alpha} = (\P\cup (D\setminus \P))\cap D\subi{\omega,\alpha}\subseteq \P\subi{\omega,\alpha} \cup (D\subi{\omega,\alpha}\cap (D\setminus \P))\]
where $D\subi{\omega,\alpha}\cap (D\setminus \P) = (D\setminus \P)$ for all $\alpha\in\R$.
So we define the extensions
\[\ext{P^\e\subi{\omega-c\zeta, \alpha}} := P^\e\subi{\omega-c\delta, \alpha}\cup (D\setminus \P)\]
and
\[\ext{P^\e\subi{\omega+c\delta, \alpha}} := P^\e\subi{\omega+c\delta, \alpha}\cup (D\setminus \P)\]
of $P^\e_\alpha$ for all $\alpha\in\R$ and $\delta\leq\e\leq\zeta$.
Moreover, our assumptions imply that we have the following sequence of inclusions by Lemma~\ref{lem:surround_and_cover}.
\[ \b\subseteq \ext{\Q^\e}\subseteq \B\subseteq\ext{\QQ^\e}\subseteq \BB.\]

% Because $\Q^\delta$ surrounds $\P$ in $D$ and $D\setminus \B\subseteq \P$ we have
% \[ B_{\alpha-c\of} = (\P\cup (D\setminus \P))\cap B_{\alpha -c\of}\subseteq \P\subi{\alpha} \cup (B_{\alpha - c\of}\cap (D\setminus \P))\]
% where $B_{\alpha - c\of}\cap (D\setminus \P) = (D\setminus \P)$ for $\alpha\geq \omega+c\of$.
% So we define the extension $\ext{\P_\alpha} := \P_\alpha\cup (D\setminus \P)$ of $\P_\alpha$ for $\alpha\geq\omega+c\of$.
% So our assumptions imply that we have the following sequence of inclusions by Lemma~\ref{lem:surround_and_cover}.
% \[ \b\subseteq \ext{\Q^\of}\subseteq \B\subseteq\ext{\QQ^\of}\subseteq \BB.\]
%
% Because the relative homology of a pair $(X, A)$ is not well defined for $A\not\subseteq X$ we introduce the following notation.
%
% \begin{align*}
%   \FQ_\alpha &:= \begin{cases}
%     \ext{\P_\alpha}&\text{ if } \alpha < \omega-c\of\\
%     \ext{\Q^\of}&\text{ otherwise.}
%   \end{cases}&
%   \FQ_\alpha' &:= \begin{cases}
%     \FQ_\alpha&\text{ if } \alpha < \omega+c\of\\
%     \ext{\QQ^\of}&\text{ otherwise. }
%   \end{cases}
% \end{align*}
% \begin{align*}
%   \FB_\alpha &:= \begin{cases}
%     D_\alpha&\text{ if } \alpha < \omega-2c\of\\
%     \b&\text{ otherwise.}
%   \end{cases}&
%   \FB_\alpha' &:= \begin{cases}
%     D_\alpha&\text{ if } \alpha < \omega\\
%     \B&\text{ otherwise.}
%   \end{cases}&
% % \end{align*}
% % \begin{align*}
%   \FB'' &:= \begin{cases}
%     D_\alpha&\text{ if } \alpha < \omega+2c\of\\
%     \BB&\text{ otherwise.}
%   \end{cases}
% \end{align*}
%
% Because all maps are induced by inclusion the following diagram commutes for all $\alpha$.
% % \[(\{(\ext{P_\alpha},\FQ_\alpha)\},\{(\ext{P_\alpha},\FQ_\alpha')\}),\]
% % \[(\{(D_\alpha, \FB_\alpha)\}, \{(D_\alpha,\FB_\alpha')\}),\]
% % \[(\{(D_\alpha, \FB_\alpha')\},\{(D_\alpha,\FB_\alpha'')\}),\]
% % such that the following diagram commutes for all $\alpha\in\R$.
% \begin{equation}\label{dgm:interleaving2}
% \begin{tikzcd}
%   \hom_k(D_{\alpha-c\of}, \FB_{\alpha-c\of})\arrow{r}{f_{\alpha-c\delta}}\arrow{d}{\gamma_{\alpha-c\delta}} &
%   \hom_k(\ext{P^\of_\alpha},\FQ_\alpha)\arrow{r}{m_\alpha}\arrow{d}{\lambda_\alpha} &
%   \hom_k(D_{\alpha+c\of}, \FB_{\alpha+c\of}')\arrow{d}{\pi_{\alpha+c\of}}\\
%   %
%   \hom_k(D_{\alpha-c\of}, \FB_{\alpha-c\of}')\arrow{r}{g_{\alpha-c\of}} &
%   \hom_k(\ext{P^\of_\alpha}, \FQ_\alpha')\arrow{r}{n_\alpha} &
%   \hom_k(D_{\alpha+c\of}, \FB_{\alpha+c\of}'')
% \end{tikzcd}\end{equation}


Because all maps are induced by inclusion the following diagram commutes for all $\alpha$ and $\delta\leq\e\leq\zeta$.
% \[(\{(\ext{P_\alpha},\FQ_\alpha)\},\{(\ext{P_\alpha},\FQ_\alpha')\}),\]
% \[(\{(D_\alpha, \FB_\alpha)\}, \{(D_\alpha,\FB_\alpha')\}),\]
% \[(\{(D_\alpha, \FB_\alpha')\},\{(D_\alpha,\FB_\alpha'')\}),\]
% such that the following diagram commutes for all $\alpha\in\R$.
\begin{equation}\label{dgm:interleaving2}
\begin{tikzcd}
  \hom_k(D\subi{\omega-c(\delta+\zeta), \alpha-c\of}, \b)\arrow{r}{f_{\alpha-c\delta}}\arrow{d}{\gamma_{\alpha-c\delta}} &
  \hom_k(\ext{P^\e\subi{\omega-c\zeta,\alpha}},\ext{\Q^\e})\arrow{r}{m_\alpha}\arrow{d}{\lambda_\alpha} &
  \hom_k(D\subi{\omega,\alpha+c\e}, \B)\arrow{d}{\pi_{\alpha+c\e}}\\
  %
  \hom_k(D\subi{\omega,\alpha-c\of}, \B)\arrow{r}{g_{\alpha-c\of}} &
  \hom_k(\ext{P^\e\subi{\omega+c\of,\alpha}}, \ext{\QQ^\e})\arrow{r}{n_\alpha} &
  \hom_k(D\subi{\omega+c(\delta+\zeta),\alpha+c\e}, \BB)
\end{tikzcd}\end{equation}

\begin{lemma}\label{lem:pt_interleaving}
  If $\hom_k(\b\to\B)$ is surjective and $\hom_k(\B)\cong \hom_k(\BB)$ for all $k$ then for all $\delta\leq\e\leq\zeta$ the $k$th persistent homology modules of \[\{(P^\e\subi{\omega-c\of,\alpha},\Q^\e)\to(P^\e\subi{\omega+c\of,\alpha},\QQ^\e)\}\] and $\{(D\subi{\omega,\alpha}, \B)\}$ are $c\e$-interleaved.
\end{lemma}
\begin{proof}
  Let $\U, \V, \W$ be the $k$th persistent homology modules of $\{(D\subi{\omega-c(\delta+\zeta), \alpha}, \b)\}$, $\{(D\subi{\omega,\alpha}, \B)\}$, $\{(D\subi{\omega+c(\delta+\zeta),\alpha}, \BB)\}$, and $\S, \T$ the $k$th persistent homology modules of $\{(\ext{P^\e\subi{\omega-c\zeta,\alpha}},\ext{\Q^\e})\}$ and $\{(\ext{P^\e\subi{\omega+c\of,\alpha}},\ext{\QQ^\e})\}$ respectively.
  Let $\Gamma\in\Hom(\U,\V)$, $\Lambda\in\Hom(\S, \T)$, and $\Pi\in\Hom(\V,\W)$ be homomorphisms induced by inclusion.
  Because Diagram~\ref{dgm:interleaving2} commutes for all $\alpha$ we have the following homomorphisms of degree $c\delta$ and $c\e$ induced by inclusion.
  \begin{align*}
    F&\in\Hom^{c\delta}(\U,\S)& M&\in\Hom^{c\e}(\S,\V)\\
    G&\in\Hom^{c\delta}(\V,\T)& N&\in\Hom^{c\e}(\T,\W)
  \end{align*}
  Because all maps are induced by inclusion we have a partial $c\e$-interleavings
  \begin{align*}
    \Phi(F, G; M)&\in\Hom^{c\e}(\im~\Gamma, \im~\Lambda), & \Psi(M, N; G)&\in\Hom^{c\e}(\im~\Lambda, \im~\Pi).
  \end{align*}

  By applying Lemma~\ref{lem:five} to the long exact sequences of the pairs $(D\subi{\omega-c(\delta+\zeta),\alpha},\b)$ and $(D\subi{\omega,\alpha},\B)$ our assumption that $\hom_k(\b\to\B)$ is surjective for all $k$ implies $\gamma_\alpha : \hom_k(D\subi{\omega-c(\delta+\zeta),\alpha},\b)\to \hom_k(D\subi{\omega,\alpha},\B)$ is surjective for all $\alpha\in\R$.
  So $\Gamma : \U\to \V$ is an epimorphism.
  Similarly, the assumption that $\hom_k(\B)\cong \hom_k(\BB)$ implies $\pi_\alpha : \hom_k(D\subi{\omega,\alpha},\B)\to \hom_k(D\subi{\omega+c(\delta+\zeta),\alpha},\BB)$ is an isomorphism by applying Lemma~\ref{lem:five} to the long exact sequences of the pairs $(D\subi{\omega,\alpha},\B)$ and $(D\subi{\omega+c(\delta+\zeta),\alpha},\BB)$.
  So $\Pi : \V\to\W$ is an isomorphism of persistence modules (and therefore a monomorphism).
  The result follows from Theorem~\ref{thm:interleaving_main}.

  % As we have shown
  % As $(\{(\ext{P_\alpha},\FQ_\alpha)\},\{(\ext{P_\alpha},\FQ_\alpha')\})$, $(\{(D_\alpha, \FB_\alpha)\}, \{(D_\alpha,\FB_\alpha')\})$, and $(\{(D_\alpha, \FB_\alpha')\},\{(D_\alpha,\FB_\alpha'')\})$ are compatible pairs of filtrations such that Digram~\ref{dgm:interleaving} commutes with $f_\alpha$ surjective and $h_\alpha$ injective for all $\alpha\in\R$ the result follows from Theorem~\ref{thm:interleaving}.


\end{proof}
