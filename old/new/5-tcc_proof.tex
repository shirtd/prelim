% !TeX root = ../new.tex

Let $\overline{X} = \R^d\setminus X$ denote the complement of any subset $X\subset\R^d$ in $\R^d$.
We have the following commutative diagrams of inclusions between the pairs $(P,Q)$ and $(\D, \B)$ and their complements \emph{in $\R^d$} with increasing scale.

\[ \begin{tikzcd}
  (P^\delta, Q^\delta) \arrow[hookrightarrow]{r}\arrow[hookrightarrow]{d} &
  (P^\gamma, Q^\gamma) \arrow[hookrightarrow]{d} \\
  %
  (\D, \B) \arrow[hookrightarrow]{r} &
  (D_1, B_1),
\end{tikzcd}\begin{tikzcd}
  (\overline{B_1}, \overline{D_1})\arrow[hookrightarrow]{r}{j}\arrow[hookrightarrow]{d} &
  (\overline{\B}, \overline{\D}) \arrow[hookrightarrow]{d}\\
  %
  (\overline{Q^\gamma}, \overline{P^\gamma}) \arrow[hookrightarrow]{r}{i} &
  (\overline{Q^\delta}, \overline{P^\delta}).
\end{tikzcd}\]

The following diagram is formed by applying the homology functor.
\begin{equation}\label{dgm:1}\begin{tikzcd}
    \hom_0(\overline{B_1}, \overline{D_1})\arrow{r}{j_*}\arrow{d} &
    \hom_0(\overline{\B}, \overline{\D}) \arrow{d} \\
    %
    \hom_0(\overline{Q^\gamma}, \overline{P^\gamma}) \arrow{r}{i_*} &
    \hom_0(\overline{Q^\delta}, \overline{P^\delta}).
\end{tikzcd}\end{equation}
Let $p_* : \im~j_*\to\im~i_*$.

\begin{lemma}\label{lem:psurj}
    Given assumptions 1 \& 2, the map $p_*$ is surjective.
\end{lemma}
\begin{proof}
  Choose a basis for $\im~i_*$ such that each basis element is represented by a point in $P^\delta\setminus Q^\gamma$.
  Let $x\in P^\delta\setminus Q^\gamma$ be such that $[x]$ is non-trivial in $\im~i_*$.
  Suppose $x\in\B$ and let $y\in B_0$ so that $\dist(x, y)\leq \gamma - \delta$.

  Now, because $x\in\overline{Q^\gamma}$ by hypothesis $\dist(x, q) > \gamma$ for all $q\in Q$.
  For any $z$ in the shortest path between $x$ and $y$ we have $\dist(x, z)\leq \dist(x, y)\leq \gamma - \delta$, so the following inequality holds for all $q\in Q$
  \begin{align*}
    \dist(x, q) & \geq \dist(x, q) - \dist(x, z)\\
                & > \gamma - (\gamma - \delta)\\
                & = \delta.
  \end{align*}
  So $z\in \overline{Q^\delta}$ for all $z$ in the shortest path from $x$ to $y$.
  In particular, $x,y\in\overline{Q^\delta}$.

  Now, suppose $y\in P^\delta$.
  So there exists some $p\in P$ such that $\dist(p, y)\leq \delta$.
  Because $f$ is $c$-Lipschitz and $y\in B_0 = B_{\omega - c\e}$
  \[ f(p)\leq c\dist(p, y) + f(y)\leq c\delta + \omega - c\e\]
  which implies $p\in Q = P\cap B_{\omega-c(\e - \delta)}$.
  % So $\dist(p, y) < \delta$ which implies $p\in Q$ thus $y\in Q^\delta$.
  But we have shown that $y\in \overline{Q^\delta}$, a contradiction, so we may assume that $y\in \overline{P^\delta}$.

  Because $x,y\in\overline{Q^\delta}$ we have corresponding chains $x,y\in C_0(\overline{Q^\delta})$ as well as $y\in\overline{P^\delta}$ generating a chain $y\in C_0(P^\delta)$.
  As we have shown that $x\in \B$ implies that the shortest path from $x$ to $y$ is contained in $\overline{Q^\delta}$ there exists a path $h: [0,1]\to \overline{Q^\delta}$ with $h(0) = x$ and $h(1) = y$ that generates a chain $h\in C_1(\overline{Q^\delta})$.
  So for $h\in C_1(\overline{Q^\delta}, \overline{P^\delta})$ with $\partial h = x + y$ we have that $x = \partial h + y$.
  Thus $[x]$ is a relative boundary and is therefore trivial in $\hom_0(\overline{P^\delta}, \overline{Q^\delta})$, a contradiction, as we have assumed $[x]$ is non-trivial in $\im~i_*$.
  So we may conclude that $x\notin \B$.

  So $x\in\overline{\B}$ and $x\in \D\setminus\B$.
  So $[x]$ is non-trivial in $\hom_0(\overline{\B},\overline{\D})$ and, because $j_*$ is surjective, $\im~j_* = \hom_0(\overline{\B},\overline{\D})$.
  So $p_*$ is surjective as $p_*[x] = [x]\in\im~p_*$ for all non-trivial $[x]\in\im~i_*$.
\end{proof}

\begin{lemma}\label{lem:coverage}
    Given assumptions 1 \& 2, if $p_*$ is injective then $\D\setminus\B\subseteq P^\delta$.
\end{lemma}
\begin{proof}
    Suppose, for the sake of contradiction, that $p_*$ is injective and there exists a point $x\in (\D\setminus\B)\setminus P^\delta$.
    So $[x]$ is non-trivial in $\hom_0(\overline{\B},\overline{\D}) = \im~j_*$ as $x$ is in some connected component of $\D\setminus\B$ and $j_*$ is surjective.
    So we have the following sequence of maps induced by inclusions
    \[ \hom_0(\overline{\B},\overline{\D})\xrightarrow{f_*} \hom_0(\overline{\B},\overline{\D}\cup\{x\})\xrightarrow{g_*} \hom_0(\overline{Q^\delta},\overline{P^\delta}).\]
    As $f_*[x]$ is trivial in $\hom_0(\overline{\B},\overline{\D}\cup\{x\})$ we have that $p_*[x] = (g_*\circ f_*)[x]$ is trivial, contradicting our hypothesis that $p_*$ is injective.
\end{proof}

\begin{corollary}\label{cor:coverage}
  Given Assumptions 1-3, if $p_*$ is injective then $\D\setminus B_\omega \subseteq P^\delta$.
\end{corollary}

\begin{lemma}\label{lem:separate}
    Given Assumptions 1-3, if the map $p_*$ is injective then $Q^\delta$ surrounds $P^\delta$ in $\D$.
\end{lemma}
\begin{proof}
    Suppose, for the sake of contradiction, that $Q^\delta$ does not surround $P^\delta$ in $\D$.
    Then there exists a path $\pi : [0,1]\to\overline{Q^\delta}$ with $\pi(0)\in P^\delta\setminus Q^\delta$ and $\pi(1)\in \D\setminus P^\delta$.
    By Lemma~\ref{lem:coverage} we know that $\D\setminus\B\subset P^\delta$.
    Moreover, because $Q\subseteq B_{\omega-c(\e -\delta)}$ and $\e \geq 2\delta$, we have $Q^\delta\subseteq B^\delta_{\omega-c(\e - \delta)}\subseteq B_\omega\subseteq \B$ by Assumption 3.
    So $\D\setminus\B\subset P^\delta\setminus Q^\delta$.

    Choose $x\in\D\setminus \B$ and $y\in \overline{\D}$ such that there exist paths $\pi_x : [0,1]\to P^\delta\setminus Q^\delta$ with $\pi_x(0) = x$, $\pi_x(1) = \pi(0)$ and $\pi_y : [0,1]\to \overline{D}\cup (\D\setminus P^\delta)$ with $\pi_y(0) = y$, $\pi_y(1) = \pi(1)$.
    $\pi_x, \pi_y$ and $\pi$ all generate chains in $C_1(\overline{Q^\delta}, \overline{P^\delta})$ and $\pi_x + \pi + \pi_y = \pi^*\in C_1(\overline{Q^\delta}, \overline{P^\delta})$ with $\partial\pi^* = x + y$.
    Moreover, $y$ generates a chain in $C_0(\overline{P^\delta})$ as $\overline{\D}\subseteq\overline{P^\delta}$.
    So $x = \partial\pi^* + y$ is a relative boundary in $C_0(\overline{Q^\delta}, \overline{P^\delta})$ thus $[x] = 0 = [y]$ in $\hom_0(\overline{Q^\delta}, \overline{P^\delta})$ and therefore $[x] = [y]$ in $\im~i_*$.
    However, because $\B$ surrounds $\D$ we know that $[x]\neq [y]$ in $\hom_0(\overline{\B}, \overline{\D})\cong \im~j_*$, contradicting our assumption that $p_*$ is injective.
\end{proof}

Recall that $Q^\delta$ surrounding $P^\delta$ in $\D$ implies that $\hat{Q^\delta}$, and therefore $\hat{Q^\gamma}$, surrounds $\D$ in $\R^d$.

\begin{lemma}\label{lem:qdcontain}
  Given Assumptions 1-3, if $p_*$ is injective then then $B_0\subseteq \hat{Q^\delta}$.
\end{lemma}
\begin{proof}
  Given Assumptions 1-3 and $p_*$ injective we have that $\D\setminus \B\subseteq P^\delta$ and $Q^\delta$ surrounds $P^\delta$ in $\D$ by Lemmas~\ref{lem:coverage} and~\ref{lem:separate}.
  Recalling that $\B = B_0^{\gamma-\delta}\cap \D$, $P\subset D_{\omega-c\e}$, and $Q = P\cap B_{\omega-c(\e - \delta)}$ we first note that $B_0\cap P^\delta\subseteq Q^\delta$ as $x\in B_0\cap P^\delta$ implies there exists some $p\in P$ such that $\dist(x, p)\leq \delta$ which, because $f$ is $c$-Lipschitz, implies
  \[ f(p) \leq c\dist(x, p) + f(x)\leq c\delta + \omega - 2c\delta = \omega - c\delta\]
  for any $x\in B_0 = B_{\omega-c\e}$.
  It follows that
  \[B_0\cap (P^\delta\setminus Q^\delta) = B_0\cap P^\delta\cap \overline{Q^\delta} \subseteq Q^\delta\cap\overline{Q^\delta} = \emptyset.\]

  As $Q^\delta$ surrounds $P^\delta$ in $\D$ we have
  \[ B_0 \subset \D = (P^\delta\setminus Q^\delta)\sqcup Q^\delta \sqcup (\D\setminus P^\delta)\]
  where $B_0\cap (P^\delta\setminus Q^\delta) = \emptyset$.
  It therefore follows that $B_0\subseteq Q^\delta \sqcup (\D\setminus P^\delta) = \hat{Q^\delta}$.
\end{proof}

\begin{lemma}\label{lem:qcontain}
    Given Assumptions 1-3, if $p_*$ is injective then $\B\subseteq \hat{Q}^\gamma$.
\end{lemma}
\begin{proof}
  As $\B = B_0^{\gamma-\delta}\cap\D$ we know that for all $x\in\B$ there exists some $y\in B_0$ such that $\dist(x, y) \leq \gamma-\delta$.
  By Lemma~\ref{lem:qdcontain} we know that $B_0\subseteq \hat{Q^\delta} = Q^\delta\sqcup (\D\setminus P^\delta)$ so either $y\in \D\setminus P^\delta$ or $y\in Q^\delta$.

  If $y\in Q^\delta$ then there exists some $q\in Q$ such that $\dist(y, q)\leq\delta$.
  Then
  \[ \dist(x, q)\leq \dist(x, y) + \dist(y, q)\leq \gamma - \delta + \delta =\gamma \]
  which would imply $x\in Q^\gamma\subset \hat{Q^\gamma}$.

  Now, suppose $y\in B_0\cap (\D\setminus P^\delta)$.
  Because $Q^\delta$ surrounds $P^\delta$ in $\D$ there is no path from $x\in \B\cap (P^\delta\setminus Q^\gamma)\subset P^\delta\setminus Q^\delta$ to $y\in B_0\cap (\D\setminus P^\delta)\subset \D\setminus P^\delta$ that does not cross $Q^\delta$.
  So there must be some point $z\in Q^\delta$ in the shortest path from $x$ to $y$.
  That is, there exists some $q\in Q$ such that $\dist(q, z)\leq \delta$ and $\dist(z, x)\leq \dist(x, y)\leq \gamma-\delta$ so
  \[ \dist(q, x)\leq \dist(q, z) + \dist(z, x) \leq \delta + \gamma - \delta = \gamma. \]
  So $y\in B_0\cap (\D\setminus P^\delta)$ implies $x\in Q^\gamma$.
\end{proof}

% \begin{theorem}[Geometric TCC]\label{thm:tcc}
%   Let $(D_0, B_0)$ and $(D_1, B_1)$ be surrounding pairs of nonempty, compact subsets of $\R^d$ satisfying assumptions 1 \& 2 for $\delta > 0$, and $\gamma > 3\delta$.
%   Let $P\subset D_0$ be a finite collection of sensors and $Q = P\cap B_0^\delta$.
%   Let $(\D, \B) = (D_0^{2\delta}, B_0^{2\delta})$ and $p_* : \im~j_*\to\im~i_*$ for $j_*$, $i_*$ as defined in Diagram~\ref{dgm:1}.
%
%   If $\rk~i_*\geq \rk~j_*$ and
%   \[ \im~\hom_k((D_0, B_0)\hookrightarrow (D_1, B_1))\cong \hom_k(\D, \B) \]
%   for all $k$ then
%   \[ \im~\hom_k((P^\delta, Q^\delta)\hookrightarrow (P^\gamma, Q^\gamma))\cong \hom_k(\D, \B) \]
%   for all $k$.
% \end{theorem}
\begin{theorem}[Geometric TCC]\label{thm:tcc}
  Let $\D$ be a compact subset of $\R^d$ and $f : \D\to\R$ be $c$-Lipschitz function.
  Let $\omega\in\R$, $\gamma\geq 3\delta > 0$, and $2\delta\leq \e\leq \gamma - \delta$ be such that $B_0 = B_{\omega -\e}$ and $B_1 = B_{\omega + c(\gamma-\delta)}$ satisfy Assumption 1-3.
  % Let $(D_0, B_0)$ and $(D_1, B_1)$ be surrounding pairs of nonempty, compact subsets of $\R^d$ satisfying assumptions 1 \& 2 for $\delta > 0$, and $\gamma > 3\delta$.
  Let $P\subset D_{\omega -\e}$ be a finite collection of sensors and $Q = P\cap B_{\omega - c(\e - \delta)}$.
  Let $\B = B_0^{\gamma-\delta}\cap \D$ and $p_* : \im~j_*\to\im~i_*$ for $j_*$, $i_*$ as defined in Diagram~\ref{dgm:1}.

  If $\rk~i_*\geq \rk~j_*$ and
  \[ \im~\hom_k((\D, B_0)\hookrightarrow (\D, B_1))\cong \hom_k(\D, \B) \]
  for all $k$ then
  \[ \im~\hom_k((P^\delta, Q^\delta)\hookrightarrow (P^\gamma, Q^\gamma))\cong \hom_k(\D, \B) \]
  for all $k$.
\end{theorem}
\begin{proof}
  Because $P$ is a finite point set we know that $\im~i_*$ is finite-dimensional.
  Because $\rk~i_*\geq \rk~j_*$ $j_*$ is finite dimensional as well so $p_*$ is injective.
  Therefore $\D\setminus\B\subseteq P^\delta$ by Lemma~\ref{lem:coverage} and $Q^\delta$ surrounds $P^\delta$ in $\D$ by Lemma~\ref{lem:separate}.
  So we can extend $(P^\delta, Q^\delta)$ and $(P^\gamma, Q^\gamma)$ to pairs $(\D, \hat{Q^\delta})$ and $(\D, \hat{Q^\gamma})$ surrounding $\D$ in $\R^d$.

  As $Q = P\cap B_{\omega - c(\e - \delta)}$ we have that
  \[ Q^\delta = B^\delta_{\omega - c(\e - \delta)}\subseteq B_\omega \subseteq \B \]
  by Assumption 3.
  % As $Q = P\cap B_0^\delta$ we have that $Q^\delta\setminus P^\delta\subset B_0^{2\delta} \B$.
  Moreover, $\D\setminus\B\subset P^\delta$ so $\D\setminus P^\delta \subset \D\setminus (\D\setminus\B) = \B$.
  So $\hat{Q^\delta} = Q^\delta\cup (\D\setminus P^\delta)\subseteq \B$.
  As $p_*$ is injective $\B\subseteq \hat{Q}^\gamma$ by Lemma~\ref{lem:qcontain}, so $\hat{Q^\delta}\subseteq \B\subseteq \hat{Q^\gamma}$.

  As
  \begin{enumerate}[label=(\alph*)]
    \item\textbf{(Covers)} $\D\setminus\B \subseteq P^\delta$,
    \item\textbf{(Surrounds)} $Q^\delta$ surrounds $P^\delta$ in $\D$, and
    \item\textbf{(Interleaves)} $\hat{Q^\delta}\subseteq \B\subseteq \hat{Q^\gamma}$.
  \end{enumerate}
  % $\D\setminus \B \subseteq P^\delta$ (\emph{(a) covers}), $Q^\delta$ surrounds $P^\delta$ in $\D$ (\emph{(b) surrounds}), and $\hat{Q^\delta}\subseteq \B\subseteq \hat{Q^\gamma}$ (\emph{(c) interleaves})
  we may conclude that $(P, Q)$ is an (open) surrounding $(\delta,\gamma)$-cover of $(\D, \B)$.
  Therefore, as $B_0\subset \hat{Q^\delta}$ by Lemma~\ref{lem:qdcontain} and, by Assumption 3,
  \[ \hat{Q^\gamma}\subseteq B_{\omega-c(\e - \delta)}^\gamma\subseteq B^{\omega + c(\gamma-\delta)} = B_1 \]
  as $\e \geq 2\delta$.
  The result follows from Theorem~\ref{thm:main}.
\end{proof}
