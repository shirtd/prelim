% !TeX root = ../../main_socg.tex

\begin{proof}[Proof of Lemma~\ref{lem:coverage}]
  This proof is in two parts.
  \begin{description}
    \item[$\ell$ injective $\implies$ $D\setminus B\subseteq U$] Suppose, for the sake of contradiction, that $p$ is injective and there exists a point $x\in (D\setminus B)\setminus U$.
      Because $B$ surrounds $D$ in $X$ the pair $(D\setminus B, \overline{D})$ forms a separation of $\overline{B}$.
      Therefore, $\hom_0(\overline{B})\cong \hom_0(D\setminus B)\oplus \hom_0(\overline{D})$ so
      \[ \hom_0(\overline{B}, \overline{D})\cong \hom_0(D\setminus B). \]
      So $[x]$ is non-trivial in $\hom_0(\overline{B},\overline{D})\cong \hom_0(D\setminus B)$ as $x$ is in some connected component of $D\setminus B$.
      So we have the following sequence of maps induced by inclusions
      \[ \hom_0(\overline{B},\overline{D})\xrightarrow{f} \hom_0(\overline{B},\overline{D}\cup\{x\})\xrightarrow{g} \hom_0(\overline{V},\overline{U}).\]
      As $f[x]$ is trivial in $\hom_0(\overline{B},\overline{D}\cup\{x\})$ we have that $\ell[x] = (g\circ f)[x]$ is trivial, contradicting our hypothesis that $\ell$ is injective.
    \item[$\ell$ injective $\implies$ $V$ surrounds $U$ in $D$.] Suppose, for the sake of contradiction, that $V$ does not surround $U$ in $D$.
      Then there exists a path $\gamma : [0,1]\to\overline{V}$ with $\gamma(0)\in U\setminus V$ and $\gamma(1)\in D\setminus U$.
      As we have shown, $D\setminus B\subseteq U$, so $D\setminus B\subseteq U\setminus V$.

      Choose $x\in D\setminus B$ and $z\in \overline{D}$ such that there exist paths $\xi : [0,1]\to U\setminus V$ with $\xi(0) = x$, $\xi(1) = \gamma(0)$ and $\zeta : [0,1]\to \overline{D}\cup (D\setminus U)$ with $\zeta(0) = z$, $\zeta(1) = \gamma(1)$.
      $\xi, \gamma$ and $\zeta$ all generate chains in $C_1(\overline{V}, \overline{U})$ and $\xi + \gamma + \zeta = \gamma^*\in C_1(\overline{V}, \overline{U})$ with $\partial\gamma^* = x + z$.
      Moreover, $z$ generates a chain in $C_0(\overline{U})$ as $\overline{D}\subseteq\overline{U}$.
      So $x = \partial\gamma^* + z$ is a relative boundary in $C_0(\overline{V}, \overline{U})$, thus $\ell[x] = \ell[z]$ in $\hom_0(\overline{V}, \overline{L})$.
      However, because $B$ surrounds $D$, $[x]\neq [y]$ in $\hom_0(\overline{B}, \overline{D})$ contradicting our assumption that $\ell$ is injective.
    \end{description}
\end{proof}

\begin{proof}[Proof of Lemma~\ref{lem:assumption2}]
  Assume there exist $p,q \in P\setminus Q_{\omega-c\zeta}$ such that $p$ and $q$ are connected in $\rips^\delta(P\setminus Q_{\omega-c\zeta})$ but not in $D\setminus B_\omega$.
  So the shortest path from $p, q$ is a subset of $(P\setminus Q_{\omega-c\zeta})^\delta$.
  For any $x\in (P\setminus Q_{\omega-c\zeta})^\delta$ there exists some $p\in P$ such that $f(p) > \omega - c\zeta$ and $\dist(p,x) < \delta$.
  Because $f$ is $c$-Lipschitz
  \[ f(x)\geq f(p) - c\dist(x,p) > \omega - c(\delta+\zeta)\]
  so there is a path from $p$ to $q$ in $D\setminus B_{\omega-c(\delta+\zeta)}$, thus $[p] = [q]$ in $\hom_0(D\setminus B_{\omega-c(\delta+\zeta)})$.

  But we have assumed that $[p]\neq[q]$ in $\hom_0(D\setminus B_\omega)$, contradicting our assumption that $\hom_0(D\setminus B_\omega\hookrightarrow D\setminus B_{\omega-c(\delta+\zeta)})$ is injective, so any $p,q$ connected in $\rips^\delta(P\setminus Q_{\omega-c\zeta})$ are connected in $D\setminus B_\omega$.
  That is, $\dim~\hom_0(\rips^\delta(P\setminus Q_{\omega-c\zeta}))\geq \dim~\hom_0(D\setminus B_\omega)$.
\end{proof}

\subsection{Extensions}

\begin{proof}[Proof of Lemma~\ref{lem:surround_and_cover}]
  Note that $B'\setminus (D\setminus U) = B'\cap U\subseteq V$ implies $B'\subseteq V\sqcup(D\setminus U) = \ext{V}$.
  Moreover, because $V\subseteq B$ and $D\setminus B\subseteq U$ implies $D\setminus U \subset D\setminus (D\setminus B) = B$, we have
  \[ \ext{V} = V\sqcup (D\setminus U) \subseteq B\cup (D\setminus U) = B. \]
  So $B' \subseteq \ext{V}\subseteq B$ as desired.
\end{proof}

\begin{lemma}\label{lem:p_interleave}
 If $Q_w^\e$ surrounds $P^\e$ in $D$ and $D\setminus B_{w + \e}\subseteq P^\e$ then we have the following sequence of homomorphisms of degree $c\e$ induced by inclusions
 \[\DD{w-c\e}\xrightarrow{F}\E\PP{w}{\e}\xrightarrow{M}\DD{w+c\e}.\]
\end{lemma}
\begin{proof}
  Suppose $x\in (P^\e\cap B\subi{w-c\e}{\alpha-c\e})\setminus B_{w+\e}$.
  Because $B_{w-\e}\subset B_{w+\e}$ we know $x\notin B_{w-\e}$ so $w+c\e < f(x)\leq \alpha-c\e$ and there exists some $p\in P$ such that $\dist(x, p) < \e$.
  Because $f$ is $c$-Lipschitz it follows
  \[ f(p)\leq f(x) + c\dist(x, p) < \alpha - c\e + c\e = \alpha\]
  and
  \[ f(p)\geq f(x) - c\dist(x, p) > w+c\e-c\e = w.\]
  So $x\in P\subi{w}{\alpha}^\e$.

  Now, suppose $x\in P\subi{w}{\alpha}^\e\setminus B_{w+c\e}$.
  So $w+c\e < f(x)$ and there exists some $p\in P\subi{w}{\alpha}$ such that $\dist(x,p) < \e$.
  Because $f$ is $c$-Lipschitz it follows
  \[ f(x) \leq f(p) + c\dist(x,p) < a + c\e.\]
  So $x\in B\subi{w+c\e}{\alpha+c\e}\setminus B_{w+c\e}$.

  Because $D\setminus B_{w+c\e}\subseteq P^\e$ we know that $D\setminus P^\e \subseteq B_{w+c\e}$, so
  \[D\subi{w-c\e}{\alpha-c\e}\setminus B_{w+c\e} \subseteq P\subi{w}{\alpha}^\e\setminus B_{w+c\e}\subseteq D\subi{w+c\e}{\alpha+c\e}\setminus B_{w+c\e}\]
  implies
  \[ D\subi{w-c\e}{\alpha-c\e}\subseteq P\subi{w}{\alpha}^\e\cup (D\setminus P^\e) = \ext{P\subi{w}{\alpha}^\e} \subseteq D\subi{w+c\e}{\alpha+c\e} \]
  as desired.

  Because $f$ is $c$-Lipschitz, $B_{w-c\e}\cap P^\delta\subseteq Q_{w}^\e$ so $B_{w-c\e} \subseteq \E Q_w^\e\subseteq B_{w+c\e}$ by Lemma~\ref{lem:surround_and_cover}.
  It follows that we have homomorphisms $F\in \Hom^{c\e}(\DD{w-c\e}, \E\PP{w}{\e})$ and $M\in\Hom^{c\e}(\E\PP{w}{\e}, \DD{w+c\e})$ induced by inclusions.
\end{proof}

\begin{proof}[Proof of Lemma~\ref{lem:excision}]
  Because $V$ surrounds $U$ in $D$, $(U\setminus V, D\setminus U)$ is a separation of $D\setminus V$, a subspace of $D$.
  So $\cl_D(U\setminus V)\setminus U = \cl_D(U\setminus V) \cap (D\setminus U) = \emptyset$ which implies $\cl_D(U\setminus V)\subseteq U = \intr_D(U)$ as $U$ is open in $D$.
  Therefore,
  \begin{align*}
    \cl_D(D\setminus U) &= D\setminus \intr_D(U)\\
                        &\subseteq D\setminus \cl_D(U\setminus V)\\
                        &= \intr_D(D\setminus (U\setminus V))\\
                        &= \intr_D(\ext{V}).
  \end{align*}
  so,
  \begin{align*}
    \hom_k(U\cap A, V) &= \hom_k(A\setminus (D\setminus U), \ext{V}\setminus (D\setminus U))\\
      &\cong \hom_k(A, \ext{V})
  \end{align*}
  for all $k$ and any $A\subseteq D$ such that $\ext{V}\subset A$ by Excision.
\end{proof}

\begin{lemma}\label{lem:extension_apply}
  If $Q_w^\e$ surrounds $P^\e$ in $D$ then then there is an isomorphism $\E_w^\e \in \Hom(\PP{w}{\e},\ext{\PP{w}{\e}})$.
\end{lemma}
\begin{proof}
  Because $P\subi{w}{a} := P\cap D\subi{w}{a}$ and $B_w\subseteq D\subi{w}{a}$ we know $Q_w = P\cap B_w \subseteq P\subi{w}{a}$ for all $a\in\R$.
  So
  \[\ext{Q^\e_a} = Q^\e_a\cup (D\setminus P^\e) \subseteq P\subi{w}{a}^\e \cup (D\setminus P^\e) = \ext{P\subi{w}{a}^\e}.\]
  As $(P^\e, Q_w^\e)$ is a surrounding pair in $D$, $P^\e$ is open in $D$ and $\ext{P\subi{w}{a}^\e}\subseteq D$ is such that $\ext{Q^\e_a}\subseteq \ext{P\subi{w}{a}^\e}$ it follows that
  \[\hom_k(P\subi{w}{a}^\e, Q^\e_a) = \hom_k(P^\e\cap \ext{P\subi{w}{a}^\e}, Q^\e_a) \cong\hom_k(\ext{P\subi{w}{a}^\e}, \ext{Q^\e_a})\]
  by Lemma~\ref{lem:excision}.

  Because these isomorphisms commute with inclusions we have an isomorphism $\E\subi{w}{\cdot}^\e \in \Hom(\PP{w}{\e},\ext{\PP{w}{\e}})$ defined to be the family $\{\E\subi{w}{\alpha}^\e : \P{w}{\e}{a}\to \E\P{w}{\e}{a}\}$.
\end{proof}

\subsection{Image Modules}

\begin{lemma}\label{lem:image_composition}
  Suppose $\Gamma\in\Hom(\U,\V)$, $\Lambda\in\Hom(\S,\T)$, and $\Lambda'\in\Hom(\S',\T')$.
  If $\Phi(F, G)\in\Hom^\delta(\im~\Gamma, \im~\Lambda)$ and $\Phi'(F', G')\in\Hom^{\delta'}(\im~\Lambda, \im~\Lambda')$ then $\Phi''(F'\circ F, G'\circ G) := \Phi'\circ\Phi\in\Hom^{\delta+\delta'}(\im~\Gamma,\im~\Lambda')$.
\end{lemma}
\begin{proof}
  Because $\Phi(F, G)$ is an image module homomorphism of degree $\delta$ we have $g_{\beta-\delta}\circ\gamma_{\alpha-\delta}[\beta-\alpha] = \lambda_\alpha[\beta-\alpha]\circ f_{\alpha-\delta}$.
  Similarly, $g_{\beta}'\circ\lambda_{\alpha}[\beta-\alpha] = \lambda_{\alpha +\delta'}'[\beta-\alpha]\circ f_{\alpha}'$.
  So $\Phi''(F'\circ F, G'\circ G)\in\Hom^{\delta+\delta'}(\im~\Gamma,\im~\Lambda')$ as
  \[ g_\beta'\circ (g_{\beta-\delta}\circ \gamma_{\alpha-\delta}[\beta-\alpha]) = (g_\beta'\circ \lambda_\alpha[\beta-\alpha])\circ f_{\alpha-\delta} =\lambda_{\alpha+\delta'}[\beta-\alpha]\circ f_\alpha'\circ f_{\alpha-\delta}\]
  for all $\alpha\leq\beta$.
\end{proof}

\begin{proof}[Proof of Lemma~\ref{thm:interleaving_main}]
  For ease of notation let $\Phi$ denote $\Phi_M(F, G)$ and $\Psi$ denote $\Psi_G(M, N)$.

  If $\Gamma$ is an epimorphism $\gamma_\alpha$ is surjective so $\Gamma_\alpha = V_\alpha$ and $\phi_{\alpha} = g_{\alpha}\rest_{\Gamma_\alpha} = g_\alpha$ for all $\alpha$.
  So $\im~\Gamma = \V$ and $\Phi\in\Hom^\delta(\V,\im~\Lambda)$.

  If $\Pi$ is a monomorphism then $\pi_\alpha$ is injective so we can define a natural isomorphism $\pi_\alpha^{-1} : \Pi_\alpha\to V_\alpha$ for all $\alpha$.
  Let $\Psi^*$ be defined as the family of linear maps $\{\psi_\alpha^* := \pi^{-1}_\alpha \circ \psi_\alpha : \Lambda_\alpha\to V_{\alpha+\delta}\}$.
  Because $\Psi$ is a partial $\delta$-interleaving of image modules, $n_\alpha\circ\lambda_\alpha = \pi_{\alpha+\delta}\circ m_\alpha$.
  So, because $\psi_\alpha = n_\alpha\rest_{\Lambda_\alpha}$ for all $\alpha$,
  \begin{align*}
    \im~\psi_\alpha^* &= \im~\pi^{-1}_{\alpha+\delta}\circ\psi_\alpha\\
                      &= \im~\pi^{-1}\circ (n_\alpha\circ\lambda_\alpha)\\
                      &= \im~\pi^{-1}\circ (\pi_{\alpha+\delta}\circ m_\alpha)\\
                      &= \im~ m_\alpha.
  \end{align*}
  It follows that $\im~v_{\alpha+\delta}^{\beta+\delta}\circ\psi_\alpha^* = \im~v_{\alpha+\delta}^{\beta+\delta}\circ m_\alpha$

  Similarly, because $\Psi$ is a $\delta$-interleaving of image modules $n_\beta\circ t_\alpha^\beta\circ \lambda_\alpha = w_{\alpha+\delta}^{\beta+\delta}\circ\pi_{\alpha+\delta}\circ m_\alpha$.
  Moreover, because $\Pi$ is a homomorphism of persistence modules, $w_{\alpha+\delta}^{\beta+\delta}\circ\pi_{\alpha+\delta} = \pi_{\beta+\delta}\circ v_{\alpha+\delta}^{\beta+\delta}$, so
  \[ n_\beta\circ t_\alpha^\beta\circ \lambda_\alpha = \pi_{\beta+\delta}\circ v_{\alpha+\delta}^{\beta+\delta}\circ m_\alpha.\]
  As $\psi_\beta\circ\lambda_\alpha^\beta = n_\beta\circ\lambda_\alpha^\beta = n_\beta\circ t_\alpha^\beta\rest_{\Lambda_\alpha}$ it follows
  \begin{align*}
    \im~\psi_\beta^*\circ\lambda_\alpha^\beta &= \im~\pi^{-1}_{\beta+\delta}\circ (n_\beta\circ t_\alpha^\beta\circ\lambda_\alpha)\\
      &= \im~\pi^{-1}_{\beta+\delta}\circ (\pi_{\beta+\delta}\circ v_{\alpha+\delta}^{\beta+\delta})\circ m_\alpha\\
      &= \im~v_{\alpha+\delta}^{\beta+\delta}\circ m_\alpha\\
      &= \im~v_{\alpha+\delta}^{\beta+\delta}\circ\psi_\alpha^*.
  \end{align*}
  So we may conclude that $\Psi^*\in\Hom^\delta(\im~\Lambda,\V)$.

  So $\Phi\in\Hom^\delta(\V,\im~\Lambda)$ and $\Psi_G^*\in\Hom^\delta(\im~\Lambda,\V)$.
  As we have shown, $\im~\psi_{\alpha-\delta}^* = \im~m_{\alpha-\delta}$ so $\im~\phi_\alpha\circ\psi_{\alpha-\delta}^* = \im~\phi_\alpha\circ m_{\alpha-\delta}$.
  Moreover, because $\gamma_\alpha$ is surjective $\phi_\alpha = g_\alpha$ and, because $\Phi$ is a partial $\delta$-interleaving of image modules, $g_\alpha\circ m_{\alpha-\delta} = t_{\alpha-\delta}^{\alpha+\delta}\circ \lambda_{\alpha-\delta}$.
  As $\lambda_{\alpha-\delta}^{\alpha+\delta} = t_{\alpha-\delta}^{\alpha+\delta}\rest_{\im~\lambda_{\alpha-\delta}}$ it follows that $\im~\phi_\alpha\circ\psi_{\alpha-\delta}^* = \im~\lambda_{\alpha-\delta}^{\alpha+\delta}$.

  Finally, $\psi_\alpha^*\circ\phi_\alpha = \pi_{\alpha+\delta}^{-1}\circ n_\alpha\circ g_{\alpha-\delta}$ where, because $\Psi$ is a partial $\delta$-interleaving of image modules, $n_\alpha\circ g_{\alpha-\delta} = w_{\alpha-\delta}^{\alpha+\delta}\circ\pi_{\alpha-\delta}$.
  Because $\Pi$ is a homomorphism of persistence modules $w_{\alpha-\delta}^{\alpha+\delta}\circ \pi_{\alpha-\delta} = \pi_{\alpha+\delta}\circ v_{\alpha-\delta}^{\alpha+\delta}$.
  Therefore,
  \begin{align*}
    \psi_\alpha^*\circ\phi_\alpha &= \pi_{\alpha+\delta}^{-1}\circ n_\alpha\circ g_{\alpha-\delta}\\
      &= \pi_{\alpha+\delta}^{-1}\circ (\pi_{\alpha+\delta}\circ v_{\alpha-\delta}^{\alpha+\delta})\\
      &= v_{\alpha-\delta}^{\alpha+\delta}
  \end{align*}
  which, along with $\phi_\alpha\circ\im~\psi_{\alpha-\delta}^* = \lambda_{\alpha-\delta}^{\alpha+\delta}$ implies Diagrams~\ref{dgm:interleaving1} and~\ref{dgm:interleaving2} commute with $\Phi\in\Hom^\delta(\V,\im~\Lambda)$ and $\Psi^*\in\Hom^\delta(\im~\Lambda, \V)$.
  We may therefore conclude that $\im~\Lambda$ and $\V$ are $\delta$-interleaved.
\end{proof}

\subsection{Partial Interleavings}

\begin{proof}[Proof of Lemma~\ref{lem:extension_apply}]
  Because $P\subi{w}{a} := P\cap D\subi{w}{a}$ and $B_w\subseteq D\subi{w}{a}$ we know $Q_w = P\cap B_w \subseteq P\subi{w}{a}$ for all $a\in\R$.
  So
  \[\ext{Q^\e_a} = Q^\e_a\cup (D\setminus P^\e) \subseteq P\subi{w}{a}^\e \cup (D\setminus P^\e) = \ext{P\subi{w}{a}^\e}.\]
  As $(P^\e, Q_w^\e)$ is a surrounding pair in $D$, $P^\e$ is open in $D$ and $\ext{P\subi{w}{a}^\e}\subseteq D$ is such that $\ext{Q^\e_a}\subseteq \ext{P\subi{w}{a}^\e}$ it follows that
  \[\hom_k(P\subi{w}{a}^\e, Q^\e_a) = \hom_k(P^\e\cap \ext{P\subi{w}{a}^\e}, Q^\e_a) \cong\hom_k(\ext{P\subi{w}{a}^\e}, \ext{Q^\e_a})\]
  by Lemma~\ref{lem:excision}.

  Because these isomorphisms commute with inclusions we have an isomorphism $\E\subi{w}{\cdot}^\e \in \Hom(\PP{w}{\e},\ext{\PP{w}{\e}})$ defined to be the family $\{\E\subi{w}{\alpha}^\e : \P{w}{\e}{a}\to \E\P{w}{\e}{a}\}$.
\end{proof}

\begin{proof}[Proof of Lemma~\ref{lem:p_interleave}]
  Suppose $x\in (P^\e\cap B\subi{w-c\e}{\alpha-c\e})\setminus B_{w+\e}$.
  Because $B_{w-\e}\subset B_{w+\e}$ we know $x\notin B_{w-\e}$ so $w+c\e < f(x)\leq \alpha-c\e$ and there exists some $p\in P$ such that $\dist(x, p) < \e$.
  Because $f$ is $c$-Lipschitz it follows
  \[ f(p)\leq f(x) + c\dist(x, p) < \alpha - c\e + c\e = \alpha\]
  and
  \[ f(p)\geq f(x) - c\dist(x, p) > w+c\e-c\e = w.\]
  So $x\in P\subi{w}{\alpha}^\e$.

  Now, suppose $x\in P\subi{w}{\alpha}^\e\setminus B_{w+c\e}$.
  So $w+c\e < f(x)$ and there exists some $p\in P\subi{w}{\alpha}$ such that $\dist(x,p) < \e$.
  Because $f$ is $c$-Lipschitz it follows
  \[ f(x) \leq f(p) + c\dist(x,p) < a + c\e.\]
  So $x\in B\subi{w+c\e}{\alpha+c\e}\setminus B_{w+c\e}$.

  Because $D\setminus B_{w+c\e}\subseteq P^\e$ we know that $D\setminus P^\e \subseteq B_{w+c\e}$, so
  \[D\subi{w-c\e}{\alpha-c\e}\setminus B_{w+c\e} \subseteq P\subi{w}{\alpha}^\e\setminus B_{w+c\e}\subseteq D\subi{w+c\e}{\alpha+c\e}\setminus B_{w+c\e}\]
  implies
  \[ D\subi{w-c\e}{\alpha-c\e}\subseteq P\subi{w}{\alpha}^\e\cup (D\setminus P^\e) = \ext{P\subi{w}{\alpha}^\e} \subseteq D\subi{w+c\e}{\alpha+c\e} \]
  as desired.

  Because $f$ is $c$-Lipschitz, $B_{w-c\e}\cap P^\delta\subseteq Q_{w}^\e$ so $B_{w-c\e} \subseteq \E Q_w^\e\subseteq B_{w+c\e}$ by Lemma~\ref{lem:surround_and_cover}.
  It follows that we have homomorphisms $F\in \Hom^{c\e}(\DD{w-c\e}, \E\PP{w}{\e})$ and $M\in\Hom^{c\e}(\E\PP{w}{\e}, \DD{w+c\e})$ induced by inclusions.
\end{proof}
%
% For all $w\in\R$ and $\e < \varrho_D$ let $\I_w^\e\in\Hom(\CPP{w}{\e}, \RPP{w}{2\e})$ and $\J_w^\e\in\Hom(\RPP{w}{\e},\CPP{w}{\e})$ be induced by the inclusions
% \[ \cech^\e(P\subi{w}{\alpha}, Q_w)\subseteq \rips^{2\e}(P\subi{w}{\alpha},Q_w)\subseteq \cech^{2\e}(P\subi{w}{\alpha}, Q_w)\]
% and define the composite maps
% \[\Sigma_w^\e := \I_w^\e\circ (\E\N_w^\e)^{-1}\in \Hom(\PP{w}{\e},\RPP{w}{2\e})\ \text{ and }\ \Upsilon_w^\e := \E\N_w^{\e}\circ \J_w^{\e}\in \Hom(\RPP{w}{\e},\PP{w}{\e}).\]
%
% \begin{proof}[Proof of Lemma~\ref{lem:rips_homomorphism_left}]
%   By the Persistent Nerve Lemma we have $\cech\Lambda\circ (\E\N_w^\e)^{-1} = (\E\N_z^{2\e})^{-1}\circ \Lambda$ for $\cech\Lambda\in\Hom(\CPP{w}{\e},\CPP{z}{2\e})$ induced by inclusions.
%   As $\rips\Lambda\circ\I_w^\e = \I_z^{2\e}\circ\cech\Lambda$
%   \[ \rips\Lambda\circ \I_w^\e\circ(\E\N_w^\e)^{-1} = \I_z^{2\e}\circ\cech\Lambda\circ (\E\N_w^\e)^{-1} = \I_z^{2\e}\circ (\E\N_z^{2\e})^{-1}\circ\Lambda.\]
%   It follows that $\rips\Lambda\circ\Sigma_w^\e = \Sigma_z^{2\e}\circ\Lambda$ by the definition of $\Sigma$.
%   So Diagram~\ref{dgm:image_homomorphism} commutes and we may therefore conclude that $\tilde{\Phi}(\Sigma_w^\e,\Sigma_z^{2\e})$ is an image module homomorphism.
%
%   By the Persistent Nerve Lemma we have $\E\N_z^{4\e} \circ\cech\Lambda'  = \cech \Lambda\circ \E\N_w^{2\e}$ for $\cech\Lambda'\in\Hom(\CPP{w}{2\e},\CPP{z}{4\e})$ induced by inclusions.
%   As $\J_z^{2\e}\circ \rips\Lambda = \cech\Lambda'\circ\J_w^\e$
%   \[ \E\N_z^{4\e}\circ \J_z^{2\e}\circ \rips\Lambda = \E\N_z^{4\e}\circ\cech\Lambda'\circ\J_w^\e = \cech \Lambda\circ \E\N_w^{2\e}\circ\J_w^\e.\]
%   Once again, Diagram~\ref{dgm:image_homomorphism} commutes by the definition of $\Upsilon$, so $\tilde{\Psi}(\Upsilon_w^{2\e},\Upsilon_z^{4\e})$ is an image module homomorphism.
% \end{proof}
%
% \begin{corollary}\label{cor:left_right}
%   If $w\leq z$ and $\e < \varrho_D / 4$ then $\tilde{\Phi}(\Sigma_w^\e,\Sigma_z^{2\e})$ is a left interleaving of image modules and $\tilde{\Psi}(\Upsilon_w^{2\e},\Upsilon_z^{4\e})$ is a right interleaving of image modules.
% \end{corollary}
% \begin{proof}
%   Because $2\e\geq 2\e$ and $w\leq z$ the pair $(\Sigma_w^\e, \Upsilon_z^{2\e})$ factors $\Lambda$ through the map $\RPP{w}{2\e}\to \RPP{z}{2\e}$ induced by inclusions.
%   It follows that $\tilde{\Phi}$ is a left interleaving of image modules via the composition of this map with $\Upsilon_z^{2\e}$.
%   Similarly, $(\Upsilon_w^{2\e}, \Sigma_z^{2\e})$ factors $\rips\Lambda$ through the map $\E\PP{w}{2\e}\to \E\PP{z}{2\e}$ induced by inclusions.
%   It follows that $\tilde{\Psi}$ is a right interleaving of image modules via the composition of this map with $\Sigma_z^{2\e}$.
%   As all maps are induced by inclusions
% \end{proof}
%
% We will now show that the image module homomorphisms
% \[ \rips\Phi := \tilde{\Phi}\circ\Phi\in\Hom^{2c\delta}(\im~\Gamma,\im~\rips\Lambda)\ \text{ and }\ \rips\Psi :=\Psi\circ\tilde{\Psi}\in\Hom^{4c\delta}(\im~\rips\Lambda, \im~\Pi).\]
% given by the compositions
% \[ \rips\Phi(\rips F, \rips G) := (\Sigma_{\omega-2c\delta}^\delta\circ F, \Sigma_{\omega+c\delta}^{2\delta}\circ G)\ \text{ and }\ \rips\Psi(\rips M, \rips N) := (M\circ \Upsilon_{\omega-2c\delta}^{2\delta}, N\circ\Upsilon_{\omega+c\delta}^{4\delta})\]
% are partial interleavings.
%
% \begin{lemma}\label{lem:rips_factor_mid}
%   $\rips\Lambda[3c\delta] = \rips G\circ\rips M$ through $\DD{\omega}$.
% \end{lemma}
% \begin{proof}
%   Let $\Theta\in\Hom(\ext{\PP{\omega-2c\delta}{2\delta}},\ext{\PP{\omega+c\delta}{2\delta}})$ and $\cech\Theta\in\Hom(\CPP{\omega-2c\delta}{2\delta}, \CPP{\omega+c\delta}{2\delta})$ be induced by inclusions so that $\Theta[4c\delta] = G\circ M$ and $\rips\Lambda = \I_{\omega+c\delta}^{2\delta}\circ\cech\Theta\circ\J_{\omega-2c\delta}^{2\delta}$.
%   So $\cech\Theta$ factors through $\Theta$ with the pair $(\E\N_{\omega-2c\delta}^{2\delta}, (\E\N_{\omega+c\delta}^{2\delta})^{-1})$ by Lemma~\ref{lem:pers_nerve}.
%   That is,
%   \begin{align*}
%     \rips\Lambda &= \I_{\omega+c\delta}^{2\delta}\circ\cech\Theta\circ\J_{\omega-2c\delta}^{2\delta}\\
%       &= (\I_{\omega+c\delta}^{2\delta}\circ (\E\N_{\omega+c\delta}^{2\delta})^{-1})\circ \Theta\circ (\E\N_{\omega-2c\delta}^{2\delta}\circ \J_{\omega-2c\delta}^{2\delta})\\
%       &= \Sigma_{\omega+c\delta}^{2\delta}\circ \Theta\circ \Upsilon_{\omega-2c\delta}^{2\delta}\\
%   \end{align*}
%   As $\Theta[4c\delta] = G\circ M$ the result follows from the definition
%   \[ \rips\Lambda[4c\delta] = (\Sigma_{\omega+c\delta}^{2\delta}\circ G)\circ (M\circ \Upsilon_{\omega-2c\delta}^{2\delta}) = \rips G\circ \rips M.\]
% \end{proof}
%
% \begin{corollary}\label{cor:rips_inter_left}
%   $\rips \Phi_{\rips M} := \tilde{\Phi}\circ \Phi\in\Hom^{2c\delta}(\im~\Gamma,\im~\rips\Lambda)$ is a partial $2c\delta$-interleaving of image modules.
% \end{corollary}
% \begin{proof}
%   Because $F,M$ are induced by inclusions and $\Upsilon_{\omega-2c\delta}^{2\delta}\circ \Sigma_{\omega-2c\delta}^{\delta}$ commutes with inclusion it follows that
%   \[\Gamma[3c\delta] = M\circ (\Upsilon_{\omega-2c\delta}^{2\delta}\circ \Sigma_{\omega-2c\delta}^{\delta})\circ F = \rips M\circ \rips F.\]
%   So $\rips\Phi$ with $\rips M$ is a left $2c\delta$-interleaving of image modules.
%   As Lemma~\ref{lem:rips_factor_mid} implies $\rips \Phi$ (with $\rips M$) is a right $2c\delta$-interleaving of image modules it follows that $\rips \Phi_{\rips M}$ is a partial $2c\delta$-interleaving of image modules.
% \end{proof}
%
% The proof of Corollary~\ref{cor:rips_inter_right} is identical to that of Corollary~\ref{cor:rips_inter_left}.
%
% \begin{corollary}\label{cor:rips_inter_right}
%   $\rips \Psi_{\rips G} := \Psi\circ\tilde{\Psi}\in\Hom^{4c\delta}(\im~\rips\Lambda, \im~\Pi)$ is a partial $4c\delta$-interleaving of image modules.
% \end{corollary}
% \begin{proof}
%   This proof is identical to that of Corollary~\ref{cor:rips_inter_left}.
%   Because $G,N$ are induced by inclusions and $\Upsilon_{\omega+c\delta}^{4\delta}\circ \Sigma_{\omega+c\delta}^{2\delta}$ commutes with inclusion
%   \[\Pi[6c\delta] = N\circ (\Upsilon_{\omega+c\delta}^{4\delta}\circ \Sigma_{\omega+c\delta}^{2\delta})\circ G = \rips N\circ \rips G.\]
%   So $\rips\Psi$ with $\rips G$ is a right $4c\delta$-interleaving of image modules.
%   As Lemma~\ref{lem:rips_factor_mid} implies $\rips \Psi$ (with $\rips G$) is a left $2c\delta$-interleaving of image modules it follows that $\rips \Psi_{\rips G}$ is a partial $4c\delta$-interleaving of image modules.
% \end{proof}
%
% \begin{proof}[Proof of Theorem~\ref{thm:interleaving_main_2}]
%   Let $\Lambda\in\Hom(\RPP{\omega-2c\delta}{2\delta}, \RPP{\omega+c\delta}{4\delta})$ be induced by inclusions.
%   Because $D\setminus B_\omega\subseteq P^\delta$ and $Q_{\omega-2c\delta}^\delta$ surrounds $P^\delta$ in $D$ Diagrams~\ref{eq:partial_left} and~\ref{eq:partial_right} commute as all maps are induced by inclusions.
%   Moreover, because $\delta < \varrho_D/4$ the isomorphisms provided by the Nerve Theorem commute with inclusions by Lemma~\ref{lem:pers_nerve}.
%
%   As we have assumed that $\hom_k(B_{\omega-3c\delta}\hookrightarrow B_\omega)$ is surjective and $\hom_k(B_\omega)\cong\hom_k(B_{\omega+5c\delta})$ the five-lemma implies $\gamma_\alpha$ is surjective and $\pi_\alpha$ is an isomorphism (and therefore injective) for all $\alpha$.
%   So $\Gamma$ is an epimorphism and $\Pi$ is a monomorphism.
%   Because $\rips \Phi_{\rips M}(\rips F, \rips G)\in\Hom^{2c\delta}(\im~\Gamma,\im~\rips\Lambda)$ is a partial $2c\delta$-interleaving of image modules and $\rips \Psi_{\rips G} (\rips M,\rips N)\in\Hom^{4c\delta}(\im~\rips\Lambda, \im~\Pi)$ is a partial $4c\delta$-interleaving of image modules it follows that $\im~\rips\Lambda$ is $4c\delta$-interleaved with $\DD{\omega}$ by Lemma~\ref{thm:interleaving_main}.
% \end{proof}

\subsection{Truncated Interval Modules}

\begin{proof}[Proof of Lemma~\ref{lem:decomposition}]
  Suppose $\alpha\leq\omega$.
  So $\hom_k(D\subi{\omega}{\alpha}, B_\omega) = 0$ as $D\subi{\omega}{\alpha} = B_\omega\cup B_\alpha$ and $\T^k_\omega = 0$ as $F_\alpha^I = 0$ for any $I\in \I^k$ such that $\omega\in I_-$.
  Moreover, $\omega\in I$ for all $I\in \I_\omega^{k-1}$, thus $F_\alpha^{I_+} = 0$ for all $\alpha\leq\omega$.
  So it suffices to assume $\omega < \alpha$.

  Consider the long exact sequence of the pair $\hom_k(D\subi{\omega}{\alpha}, B_\omega) = \hom_k(B_\alpha, B_\omega)$
  \[ \ldots\to \hom_k(B_\omega)\xrightarrow{p_\alpha^k} \hom_k(B_\alpha)\xrightarrow{q_\alpha^k}\hom_k(D\subi{\omega}{\alpha}, B_\omega)\xrightarrow{r_\alpha^k} \hom_{k-1}(B_\omega)\xrightarrow{p_\alpha^{k-1}}\hom_{k-1}(B_\alpha)\to\ldots\]
  where $\hom_k(B_\alpha) = \bigoplus_{I\in \I^k}F_\alpha^I$, $\hom_k(B_\omega) = \bigoplus_{I\in \I^k}F_\omega^I$, and $p_\alpha^k = \displaystyle\bigoplus_{I\in\I^k} f_{\omega,\alpha}^I$.

  % By exactness $\ker~p_\alpha^k = \im~p_\alpha^k = \bigoplus_{I\in\I^k}\im~f_{\omega,\alpha}^I = \bigoplus_{I\in\I^k \mid \omega\in I} F_\alpha^I.$
  % By exactness $\ker~r_\alpha^k = \im~q_\alpha^k \cong \hom_k(B_\alpha) / \ker~q_\alpha^k$ $ where the image of
  % We first note that $\im~p_\alpha^k$ is equal to the direct sum of images $\im~f_{\omega,\alpha}^I$.
  % By the definition of $F_\alpha^I$ we know $\im~f_{\omega,\alpha}^I$ is $F_\alpha^I$ if $\omega\in I$, 0 otherwise.
  Noting that $\im~q_\alpha^k \cong \hom_k(B_\alpha) / \ker~q_\alpha^k$ where $\ker~q_\alpha^k = \im~p_\alpha^k$ by exactness we have $\ker~r_\alpha^k \cong \hom_k(B_\alpha) / \im~p_\alpha^k$.
  By the definition of $F_\alpha^I$ and $f_{\omega,\alpha}^I$ we know $\im~f_{\omega,\alpha}^I$ is $F_\alpha^I$ if $\omega\in I$ and 0 otherwise.
  As $\im~p_\alpha^k$ is equal to the direct sum of images $\im~f_{\omega,\alpha}^I$ over $I\in\I^k$ it follows that $\im~p_\alpha^k$ is the direct sum of those $F_\alpha^I$ over those $I\in\I^k$ such that $\omega\in I$.
  Now, because $\hom_k(B_\alpha) = \bigoplus_{I\in \I^k}F_\alpha^I$ and each $F_\alpha^I$ is either 0 or $\FF$ the quotient $\hom_k(B_\alpha) / \im~p_\alpha^k$ is the direct sum of those $F_\alpha^I$ such that $\omega\notin I$.
  Therefore, by the definition of $F\subi{\omega}{\alpha}^I$ we have
  \[ \ker~r_\alpha^k = \bigoplus_{I\in\I_\omega^k} F\subi{\omega}{\alpha}^I.\]
  % Thus, \[\ker~r_\alpha^k \cong \hom_k(B_\alpha) / \ker~q_\alpha^k = \bigoplus_{I\in \I^k\mid \omega\notin I} F_\alpha^I = \bigoplus_{I\in\I^k} F\subi{\omega}{\alpha}^I.\]

  Similarly, $\im~r_\alpha^k = \ker~p_\alpha^{k-1}$ by exactness where $\ker~p_\alpha^{k-1}$ is the direct sum of kernels $\ker~f_{\omega,\alpha}^I$ over $I\in\I^{k-1}$.
  By the definition of $F_\alpha^I$ and $f_{\omega,\alpha}^I$ we know that $\ker~f_{\omega,\alpha}^I$ is $F_\alpha^I$ if $\omega\notin I$ and $0$ otherwise.
  % If $\ker~f_{\omega,\alpha}^I = 0$ then either $\alpha\in I$ and $\omega\notin I$, $\alpha\notin I$ and $\omega \in I$, or $\alpha\notin I$ and $\omega\notin I$.
  % So it suffices to consider $I\in \I_\omega^{k-1}$ as $\ker~f_{\omega,\alpha}^I = 0$ for any $I\in \I^{k-1}$ such that $\omega\notin I$.
  Noting that $\ker~f_{\omega,\alpha}^I = 0$ for any $I\in \I^{k-1}$ such that $\omega\notin I$ it suffices to consider only those $I\in \I_\omega^{k-1}$.
  % Recalling that $I_+ = [t,\infty)$ for $I = [s,t)$
  It follows that $\ker~f_{\omega,\alpha}^I = F_\alpha^{I_+}$ for any $I$ containing $\omega$ as $\omega < \alpha$.
  Therefore,
  \[\im~r_\alpha^k = \bigoplus_{I\in\I^{k-1}} F_\alpha^{I_+}.\]

  We have the following split exact sequence associated with $r_\alpha^k$
  % \[ 0\to \ker~r_\alpha^k\xrightarrow{\phi_\alpha^k}\bigoplus_{J\in\J^k} F_\alpha^J\xrightarrow{\psi_\alpha^k}\im~r_\alpha^k\to 0.\]
  \[ 0\to \ker~r_\alpha^k\to \hom_k(D\subi{\omega}{\alpha}, B_\omega)\to\im~r_\alpha^k\to 0.\]
  The desired result follows from the fact that for all $\alpha\in\R$
  % \[ \bigoplus_{J\in\J^k} F_\alpha^J \cong \ker~r_\alpha^k\oplus \im~r_\alpha^k
  %   \cong\left(\bigoplus_{I\in\I^k} F\subi{\omega}{\alpha}^I\right)\oplus\left(\bigoplus_{I\in\I^{k-1}} F\subi{\omega}{\alpha}^{I_+}\right).\]
  \begin{align*}
    \hom_k(D\subi{\omega}{\alpha}, B_\omega) &\cong \ker~r_\alpha^k\oplus \im~r_\alpha^k\\
      &=\bigoplus_{I\in\I^k} F\subi{\omega}{\alpha}^I\oplus \bigoplus_{I\in\I_\omega^{k-1}} F_\alpha^{I_+}.
      % &\cong\left(\bigoplus_{I\in\I^k} F\subi{\omega}{\alpha}^I\right)\oplus\left(\bigoplus_{I\in\I_\omega^{k-1}} F_\alpha^{I_+}\right).
  \end{align*}
    % thus $\DD{\omega}^k = \T^k_\omega \oplus \bigoplus_{I\in \I_\omega^{k-1}} \FF^{I_+}
\end{proof}
