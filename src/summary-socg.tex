% !TeX root = ../main_socg.tex

Let $\X$ denote an orientable $d$-manifold and $D\subset\X$ a compact subspace.
For a $c$-Lipschitz functon $f : D\to \R$ and $\alpha\in\R$ let $B_\alpha := f^{-1}((-\infty,\alpha])$ denote the $\alpha$-sublevel set of $f$.
Our sample will be denoted $P$, and the subset of points sampling $B_\alpha$ will be denoted $Q_\alpha := P\cap B_\alpha$.
For $\e > 0$ let $P^\e$ denote the union of open metric balls centered at points in $P$.
For ease of exposition let
\[ D\subi{z}{\alpha} := B_\alpha\cup B_z \]
denote the \emph{$z$-truncated} sublevel sets of $f$ and % of the restricted function $f\rest_{D\setminus B_w}$ for all $\alpha,w\in\R$.
\[ P\subi{z}{\alpha} := Q_\alpha\cup Q_z\]
for all $z,\alpha\in\R$.\footnote{\textbf{I'm starting to think:} \emph{For ease of exposition let pairs $(D_\alpha, B_z)$ denote $(B_{\scriptscriptstyle\max\{\alpha,z\}},B_z)$ so that $B_z\subseteq D_\alpha$ for all $\alpha\in\R$. Outside of a pair, we will refer to $D_\alpha$ as \_. Similarly, let $(P_\alpha^\e, Q_z^\e)$ denote $(Q_{\scriptscriptstyle\max\{\alpha,z\}}, Q_z)$.}}
\footnote{\textbf{Options:}
  $(P_{\scriptscriptstyle \lfloor\alpha\rfloor_{z+c\e}}^\e, Q_{z+c\e}^\e)$,
  $(P_{\scriptscriptstyle\alpha\mid z+c\e}^\e, Q_{z+c\e}^\e)$,
  $(P_{\scriptscriptstyle\max\{\alpha, z+c\e\}}^\e, Q_{z+c\e}^\e)$,
  $(P_{\alpha {\scriptscriptstyle  > z+c\e}}^\e, Q_{z+c\e}^\e)$,
  $(P_{\scriptscriptstyle \alpha; z+c\e}^\e, Q_{z+c\e}^\e)$,
  $(P_{\scriptscriptstyle z+c\e, \alpha}^\e, Q_{z+c\e}^\e)$,
  $((Q_\alpha\cup Q_{z+c\e})^\e, Q_{z+c\e}^\e)$;
  Throughout, let $(P_\alpha^\e, Q_{z+c\e}^\e)$ denote the pair $(Q_{\max\{\alpha, z+c\e\}}^\e, Q_{z+c\e}^\e)$ so that $Q_{z+c\e}^\e \subseteq P_\alpha^\e$ for all $\alpha\in\R$;
  Define filtrations for $\alpha\geq z+c\e$ and handle all of the edge cases by hand (there are a lot and it's gross).
}

We will select a sublevel set $B_\omega$ of $f$ that \emph{surrounds} $D$ to serve as our boundary.
Given a sample of $f$ at a finite number of points $P$ in $D$ we would like to confirm $P^\delta$ not only covers the interior $D\setminus B_\omega$, but also that $Q^\delta$ surrounds $P^\delta$ for some $Q\subset P$.
That is, we would like to verify that a pair $(P^\delta, Q^\delta)$ is %homologically
representative of the pair $(D,B_\omega)$ in homology.
Our goal is to use this fact to approximate the persistence of $f$ relative to $B_\omega$.

\paragraph*{Results}

Our approximation will be by a nested pair of (Vietoris-)Rips complexes, denoted $\rips^\e(P, Q) = (\rips^\e(P), \rips^\e(Q))$ for $\e > 0$.
Under mild regularity assumptions it can be shown that
\[ \rk~\hom_d(\rips^\delta(P, Q_{\omega - 2c\delta})\hookrightarrow \rips^{2\delta}(P, Q_{\omega+c\delta}))\geq \dim~\hom_0(\rips^\delta(P\setminus Q_{\omega-2c\delta}))\]
implies $D\setminus B_\omega\subseteq P^\delta$ and $Q_{\omega-2c\delta}^\delta$ surrounds $P^\delta$ in $D$.
Proof of this fact generalizing the proof of the TCC to boundaries defined in terms of a function $f$, eliminating unnatural assumptions made in previous work.
Not only are our subsamples $Q_{\omega-2c\delta}$ and $Q_{\omega+c\delta}$ defined in terms of their function values, but our regularity assumptions can be stated directly in terms of the persistent homology of $f$.

% Given a sample $P$ such that $D\setminus B_\omega\subseteq P^\delta$ and $Q_{\omega-2c\delta}^\delta$ surrounds $P^\delta$ in $D$ we can approximate the persistent homology of $f$ in a specific way.
Given a sample $P$ that satisfies the TCC we can approximate the persistent homology of $f$ in a specific way.
The nested pair of Rips complexes used to confirm coverage can be extended to a filtration
\[ \{\rips^{2\delta}(P\subi{\omega-2c\delta}{\alpha}, Q_{\omega-2c\delta})\hookrightarrow \rips^{4\delta}(P\subi{\omega+c\delta}{\alpha}, Q_{\omega+c\delta})\}_{\alpha\in\R}\]
that can be used to approximate the persistent homology of $\{(D\subi{\omega}{\alpha}, B_\omega)\}_{\alpha\in\R}$.
Indeed, we could use existing methods to approximate the persistent homology of $f$ \emph{restricted} to the subspace $D\setminus B_\omega$ that we cover.
However, the question of what this would approximate is important to consider.
{\color{red} Restricting the domain of the function can not only introduce noise close to the boundary, \textbf{but also perturb global structure in our signature.}\footnote{\color{red} close.}}
As an alternative, we approximate the persistence of $f$ \emph{relative} to the sublevel set $B_\omega$.
This is not only to eliminate noise introduced by the restriction, but also to \emph{truncate} the persistence of $f$ in a way that isolates global structure.

% By restricting the domain important global structure of the function near $\omega$ can appear as noise
%
% We would like to confirm that a sample $P$ not only covers the interior $D\setminus B_\omega$ at some scale $\delta$, but that there is a subset $Q$ of $P$ that serves as a sampled boundary.
% That is, we would like to confirm that a pair $(P^\delta, Q^\delta)$ is a good approximation of $(D, B_\omega)$ topologically.
% We can then use this fact to approximate the persistent homology of the relative filtration $\{(D\subi{\omega}{\alpha}, B_\omega)\}_{\alpha\in\R}$.
%
% This will be done using an approximation by nested pairs of \emph{(Vietoris-)Rips complexes}, denoted $\rips^\e(P, Q) := (\rips^\e(P), \rips^\e(Q))$ for $\e > 0$.
% Specifically, we will show that the condition
% \[ \rk~\hom_d(\rips^\delta(P, Q_{\omega - 2c\delta})\hookrightarrow \rips^{2\delta}(P, Q_{\omega+c\delta}))\geq \dim~\hom_0(\rips^\delta(P\setminus Q_{\omega-2c\delta}))\]
% verifies that $D\setminus B_\omega\subseteq P^\delta$ and $Q_{\omega-2c\delta}^\delta$ surrounds $P^\delta$ in $D$.
% This requires generalizing the TCC to boundaries defined as sublevel sets, a setting that applies more naturally to applications in data analysis.
%
% Given a verified sample we can then re-use our Rips complex as a filtration
% \[ \{\rips^{2\delta}(P\subi{\omega-2c\delta}{\alpha}, Q_{\omega-2c\delta})\hookrightarrow \rips^{4\delta}(P\subi{\omega+c\delta}{\alpha}, Q_{\omega+c\delta})\}_{\alpha\in\R}\]
% to approximate the persistent homology of the relative filtration $\{(D\subi{\omega}{\alpha}, B_\omega)\}_{\alpha\in\R}$.
% Indeed, we could use existing methods to approximate the persistent homology of $f$ restricted to the subspace $D\setminus B_\omega$ that we cover.
% In a way that mirrors the TCC we instead approximate the persistent relative homology in order to cancel out noise introduced by the restriction.
% This approach utilizes the property that the subsample $Q^\delta$ \emph{surrounds} $P^\delta$, allowing us to isolate the un-verified region without restriction.

\paragraph*{Outline}

We will begin with our statement of the TCC in Section~\ref{sec:tcc}.
Part of the proof of the TCC will be generalized to properties of \emph{surrounding pairs}, simplifying our reformulation of the TCC in Theorem~\ref{thm:algo_tcc}.
% This requires the introduction of surrounding pairs before proving our reformulation of the TCC (Theorem~\ref{thm:algo_tcc}).
Section~\ref{sec:middle} introduces extensions of surrounding pairs, as well as partial interleavings of image modules.
This is to show that a positive result from the TCC verifies that a surrounding pair of samples can be used to approximate the persistence of a function relative to a sublevel set in Theorem~\ref{thm:interleaving_main_2}.
In Section~\ref{sec:truncations} we provide an interpretation of this relative persistence as a truncation of the full diagram that is motivated by examples in Section~\ref{sec:experiments}.
