% !TeX root = ../../main.tex

We will now prove our interleaving in terms of the constants introduced in Section~\ref{sec:geo_tcc}.

Suppose $Q_{\omega-c\zeta}^\delta$ surrounds $P^\delta$ in $D$ and $D\setminus B_\omega\subseteq P^\delta$ for $\zeta\geq 2\delta$.
Then, because $f$ is $c$-Lipschitz, $B_{\omega-c(\delta+\zeta)}\cap P^\delta\subseteq Q_{\omega-c\zeta}^\delta$ and $B_\omega\cap P^\delta\subseteq Q_{\omega+c\delta}^\zeta$.
Similarly, $Q_{\omega-c\zeta}^{2\delta}\subseteq B_\omega$ and $Q_{\omega+c\delta}^{2\zeta}\subseteq B_{\omega+c{\delta+2\zeta}}$.
Therefore, by Lemma~\ref{lem:surround_and_cover}
\[ B_{\omega-c(\delta+\zeta)}\subseteq \E Q_{\omega-c\zeta}^\delta\subseteq\E Q_{\omega-c\zeta}^{2\delta}\subseteq B_\omega
  \subseteq \E Q_{\omega+c\delta}^\zeta\subseteq \E Q_{\omega+c\delta}^{2\zeta}\subseteq B_{\omega+c{\delta+2\zeta}}.\]
%
Now, by Lemma~\ref{lem:p_interleave} we have the following commutative diagrams of persistence modules where all maps are induced by inclusions.
\[\begin{tikzcd}
    \DD{\omega-c(\delta+\zeta)} \arrow{r}{\Gamma}\arrow{d}{F} &
    \DD{\omega} \arrow{d}{G}\\
    %
    \E\PP{\omega-c\zeta}{\delta}\arrow{r}{\Lambda} &
    \E\PP{\omega+c\delta}{\zeta}
  \end{tikzcd}\hspace{10ex}
  \begin{tikzcd}
    \E\PP{\omega-c\zeta}{2\delta} \arrow{r}{\Lambda'}\arrow{d}{M} &
    \E\PP{\omega+c\delta}{2\zeta}\arrow{d}{N}\\
    %
    \DD{\omega} \arrow{r}{\Pi} &
    \DD{\omega+c(\delta+2\zeta)}.
  \end{tikzcd}\]

In the following let $\rips\Lambda\in\Hom(\RPP{\omega-c\zeta}{2\delta},\RPP{\omega+c\delta}{2\zeta})$ be induced by inclusion.
Clearly, $\Phi(F, G)$ is an image module homomorphism of degree $c\zeta$ and $\Psi(M, N)$ is an image module homomorphism of degree $2c\zeta$.
By Lemma~\ref{lem:rips_homomorphism_left} we have image module homomorphisms $\tilde{\Phi}(\Sigma_{\omega-c\zeta}^\delta, \Sigma_{\omega+c\delta}^\zeta)$ and $\tilde{\Psi}(\Upsilon_{\omega-c\zeta}^{2\delta}, \Upsilon_{\omega+c\delta}^{2\zeta})$.
Therefore, by Lemma~\ref{lem:image_composition} we have image module homomorphisms
\[ \rips\Phi := \tilde{\Phi}\circ\Phi\in\Hom^{c\zeta}(\im~\Gamma,\im~\rips\Lambda)\ \text{ and }\ \rips\Psi :=\Psi\circ\tilde{\Psi}\in\Hom^{2c\zeta}(\im~\rips\Lambda, \im~\Pi)\] given by the compositions
\[ \rips\Phi(\rips F, \rips G) := (\Sigma_{\omega-c\zeta}^\delta\circ F, \Sigma_{\omega+c\delta}^\zeta\circ G)\]
and
\[ \rips\Psi(\rips M, \rips N) := (M\circ \Upsilon_{\omega-c\zeta}^{2\delta}, N\circ\Upsilon_{\omega+c\delta}^{2\zeta}).\]

\begin{lemma}\label{lem:rips_factor_mid}
  The pair $(\rips M, \rips G)$ factors $\rips\Lambda[2c\delta+c\zeta]$ through $\DD{\omega}$.
\end{lemma}
\begin{proof}
  Let $\Theta\in\Hom(\ext{\PP{\omega-c\zeta}{2\delta}},\ext{\PP{\omega+c\delta}{\zeta}})$ and $\cech\Theta\in\Hom(\CPP{\omega-c\zeta}{2\delta}, \CPP{\omega+c\delta}{\zeta})$ be induced by inclusions so that $\Theta[2c\delta+c\zeta] = G\circ M$ and $\rips\Lambda = \I_{\omega+c\delta}^\zeta\circ\cech\Theta\circ\J_{\omega-c\zeta}^{2\delta}$.
  So $\cech\Theta$ factors through $\Theta$ with the pair $(\E\N_{\omega-c\zeta}^{2\delta}, (\E\N_{\omega+c\delta}^\zeta)^{-1})$ by Lemma~\ref{cor:excisive_nerve}.
  That is,
  \begin{align*}
    \rips\Lambda &= \I_{\omega+c\delta}^\zeta\circ\cech\Theta\circ\J_{\omega-c\zeta}^{2\delta}\\
      &= (\I_{\omega+c\delta}^\zeta\circ (\E\N_{\omega+c\delta}^\zeta)^{-1})\circ \Theta\circ (\E\N_{\omega-c\zeta}^{2\delta}\circ \J_{\omega-c\zeta}^{2\delta})\\
      &= \Sigma_{\omega+c\delta}^\zeta\circ \Theta\circ \Upsilon_{\omega-c\zeta}^{2\delta}\\
  \end{align*}
  As $\Theta[2c\delta+c\zeta] = G\circ M$ the result follows from the definition
  \[ \rips\Lambda[2c\delta+c\zeta] = (\Sigma_{\omega+c\delta}^\zeta\circ G)\circ (M\circ \Upsilon_{\omega-c\zeta}^{2\delta}) = \rips G\circ \rips M.\]
\end{proof}

\begin{corollary}\label{cor:rips_inter_left}
  $\rips \Phi_{\rips M} := \tilde{\Phi}\circ \Phi\in\Hom^{2c\delta}(\im~\Gamma,\im~\rips\Lambda)$ is a partial $c\zeta$-interleaving of image modules.
\end{corollary}
\begin{proof}
  Because $F,M$ are induced by inclusions and $\Upsilon_{\omega-c\zeta}^{2\delta}\circ \Sigma_{\omega-c\zeta}^{\delta}$ commutes with inclusion it follows that
  \[\Gamma[3c\delta] = M\circ (\Upsilon_{\omega-c\zeta}^{2\delta}\circ \Sigma_{\omega-c\zeta}^{\delta})\circ F = \rips M\circ \rips F.\]
  So $\rips\Phi$ with $\rips M$ is a left $2c\delta$-interleaving of image modules.
  As Lemma~\ref{lem:rips_factor_mid} implies $\rips \Phi$ (with $\rips M$) is a right $c\zeta$-interleaving of image modules it follows that $\rips \Phi_{\rips M}$ is a partial $c\zeta$-interleaving of image modules.
\end{proof}

The proof of Corollary~\ref{cor:rips_inter_right} is identical to that of Corollary~\ref{cor:rips_inter_left}.

\begin{corollary}\label{cor:rips_inter_right}
  $\rips \Psi_{\rips G} := \Psi\circ\tilde{\Psi}\in\Hom^{2c\zeta}(\im~\rips\Lambda, \im~\Pi)$ is a partial $2c\zeta$-interleaving of image modules.
\end{corollary}\begin{proof}
  (See Appendix~\ref{apx:omit})
\end{proof}
\proofatend
  % This proof is identical to that of Corollary~\ref{cor:rips_inter_left}.
  Because $G,N$ are induced by inclusions and $\Upsilon_{\omega+c\delta}^{2\zeta}\circ \Sigma_{\omega+c\delta}^{\zeta}$ commutes with inclusion
  \[\Pi[3c\zeta] = N\circ (\Upsilon_{\omega+c\delta}^{2\zeta}\circ \Sigma_{\omega+c\delta}^{\zeta})\circ G = \rips N\circ \rips G.\]
  So $\rips\Psi$ with $\rips G$ is a right $2c\zeta$-interleaving of image modules.
  As Lemma~\ref{lem:rips_factor_mid} implies $\rips \Psi$ (with $\rips G$) is a left $c\zeta$-interleaving of image modules it follows that $\rips \Psi_{\rips G}$ is a partial $2c\zeta$-interleaving of image modules.
\endproofatend

\begin{theorem}\label{thm:interleaving_main_2}
  Let $D\subset\X$ and $f : D\to\R$ be a $c$-Lipschitz function.
  Let $\omega\in\R$, $2\delta\leq\zeta\leq\varrho_D/2$ be constants such that $B_{\omega-c(\delta+\zeta)}$ surrounds $D$ in $\X$.
  Let $P\subset D$ be a finite subset and $Q_w := P\cap B_w$.
  Suppose $\hom_k(B_{\omega-c(\delta+\zeta)}\hookrightarrow B_\omega)$ is surjective and $\hom_k(B_\omega)\cong\hom_k(B_{\omega+c(\delta+2\zeta)})$ for all $k$.
  Let $\Lambda\in\Hom(\RPP{\omega-c\zeta}{2\delta}, \RPP{\omega+c\delta}{2\zeta})$ be induced by inclusion.

  If $D\setminus B_\omega\subseteq P^\delta$ and $Q_{\omega-c\zeta}^\delta$ surrounds $P^\delta$ in $D$ then $\im~\Lambda$ is $2c\zeta$-interleaved with $\DD{\omega}$.
\end{theorem}
\begin{proof}
  Because $D\setminus B_\omega\subseteq P^\delta$ and $Q_{\omega-c\zeta}^\delta$ surrounds $P^\delta$ in $D$ Diagrams~\ref{TODO} and~\ref{TODO} commute as all maps are induced by inclusions.
  Moreover, because $\zeta < \varrho_D/2$ the isomorphisms provided by the Nerve Theorem commute with inclusions by Lemma~\ref{cor:excisive_nerve}.

  % Let $\rips\Lambda \in\Hom(\RPP{\omega-c\zeta}{2c\delta}, \RPP{\omega+c\delta}{2c\zeta})$ be induced by inclusions.
  By Corollary~\ref{cor:rips_inter_left} $\rips \Phi_{\rips M}(\rips F, \rips G)\in\Hom^{2c\delta}(\im~\Gamma,\im~\rips\Lambda)$ is a partial $c\zeta$-interleaving of image modules.
  Similarly, by Corollary~\ref{cor:rips_inter_right} $\rips \Psi_{\rips G} (\rips M,\rips N)\in\Hom^{2c\zeta}(\im~\rips\Lambda, \im~\Pi)$ is a partial $2c\zeta$-interleaving of image modules.

  As we have assumed that $\hom_k(B_{\omega-c(\delta+\zeta)}\hookrightarrow B_\omega)$ is surjective and $\hom_k(B_\omega)\cong\hom_k(B_{\omega+c(\delta+2\zeta)})$ the five-lemma implies $\gamma_\alpha$ is surjective and $\pi_\alpha$ is an isomorphism (and therefore injective) for all $\alpha$.
  So $\Gamma$ is an epimorphism and $\Pi$ is a monomorphism, thus $\im~\rips\Lambda$ is $2c\zeta$-interleaved with $\DD{\omega}$ by Lemma~\ref{thm:interleaving_main} as desired.
\end{proof}
